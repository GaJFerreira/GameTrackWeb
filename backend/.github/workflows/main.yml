name: GameTrack CI

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  # Job para testar o Backend
  backend-test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3

    - name: Set up Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"

    # Recria o arquivo de credenciais a partir do segredo
    - name: Create Firebase Credentials File
      run: |
        echo "${{ secrets.FIREBASE_CREDENTIALS_BASE64 }}" | base64 -d > backend/firebase-credentials.json

    # Cria o arquivo .env com as chaves
    - name: Create .env file
      run: |
        echo "firebase_credentials_path=firebase-credentials.json" >> backend/.env
        echo "steam_api_key=${{ secrets.STEAM_API_KEY }}" >> backend/.env
        echo "firebase_web_api_key=${{ secrets.FIREBASE_WEB_API_KEY }}" >> backend/.env

    - name: Install Dependencies
      run: |
        cd backend
        pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run Tests
      run: |
        cd backend
        pytest

  # Job para testar o Frontend
  frontend-test:
    runs-on: ubuntu-latest
    needs: backend-test # Opcional: só roda se o backend passar
    
    steps:
    - uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: 'Frontend/package-lock.json'

    - name: Install Dependencies
      run: |
        cd Frontend
        npm ci

    - name: Run Build (Verifica se compila sem erros)
      run: |
        cd Frontend
        npm run build --if-present
        
    # Descomente abaixo se tiver testes unitários no frontend
    # - name: Run Tests
    #   run: |
    #     cd Frontend
    #     npm test -- --watchAll=false